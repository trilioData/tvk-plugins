[2021-11-18 20:38:47] [ INFO ] --- Running Pre-flight Checks ---

[2021-11-18 20:38:47] [ INFO ] Writing logs to file -> preflight-log-2021-11-18_20-38-47.log

[2021-11-18 20:38:47] [ INFO ] Might take a few minutes to execute all Pre-flight Checks...

[2021-11-18 20:38:47] [ INFO ] Checking for kubectl...

kubectl found at path - /usr/local/bin/kubectl
[2021-11-18 20:38:47] [ INFO ]  ✔ Found kubectl

[2021-11-18 20:38:47] [ INFO ] Checking access to the Kubernetes context gke_amazing-chalice-243510_europe-north1-a_pallav-gke...

[2021-11-18 20:38:49] [ INFO ]  ✔ Able to access the default Kubernetes namespace

[2021-11-18 20:38:49] [ INFO ] Checking for required Helm version (>= v3.0.0)...

helm found at path - /usr/sbin/helm
[2021-11-18 20:38:53] [ INFO ]  ✔ Found helm

[2021-11-18 20:38:53] [ INFO ]  ✔ Helm version v3.6.3 meets minimum required version v3.0.0

[2021-11-18 20:38:53] [ INFO ] Checking for required Kubernetes version (>= v1.18.0)...

[2021-11-18 20:38:55] [ INFO ]  ✔ Kubernetes version (v1.19.14-gke.1900) meets minimum requirements

[2021-11-18 20:38:55] [ INFO ] Checking if Kubernetes RBAC is enabled...

[2021-11-18 20:38:57] [ INFO ]  ✔ Kubernetes RBAC is enabled

[2021-11-18 20:38:57] [ INFO ] Checking if a StorageClass and VolumeSnapshotClass are present...

[2021-11-18 20:38:58] [ INFO ]  ✔ Storage class "csi-gce-pd" found

[2021-11-18 20:39:01] [ INFO ]  ✔ Volume snapshot class "default-snapshot-class" found in cluster

[2021-11-18 20:39:02] [ INFO ]  ✔ Volume snapshot class "default-snapshot-class" driver matches with given StorageClass's provisioner=pd.csi.storage.gke.io

[2021-11-18 20:39:02] [ INFO ] Checking if CSI APIs are installed in cluster...

[2021-11-18 20:39:04] [ INFO ]  ✔ Found volumesnapshotclasses.snapshot.storage.k8s.io

[2021-11-18 20:39:08] [ INFO ]  ✔ Found volumesnapshotcontents.snapshot.storage.k8s.io

[2021-11-18 20:39:09] [ INFO ]  ✔ Found volumesnapshots.snapshot.storage.k8s.io

[2021-11-18 20:39:09] [ INFO ] Checking if DNS resolution working in K8s cluster...

pod/dnsutils-bsijqj created
pod/dnsutils-bsijqj condition met
Server:		10.215.240.10
Address:	10.215.240.10#53

Name:	kubernetes.default.svc.cluster.local
Address: 10.215.240.1

[2021-11-18 20:39:19] [ INFO ]  ✔ Able to resolve DNS "kubernetes.default" service inside pods

I1118 20:39:19.651407  566872 loader.go:375] Config loaded from file:  /home/pallavmathur/.kube/config
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
I1118 20:39:19.656904  566872 request.go:1097] Request Body: {"gracePeriodSeconds":0,"propagationPolicy":"Background"}
I1118 20:39:19.656938  566872 round_trippers.go:420] DELETE https://35.228.43.178/api/v1/namespaces/default/pods/dnsutils-bsijqj
I1118 20:39:19.656943  566872 round_trippers.go:427] Request Headers:
I1118 20:39:19.656948  566872 round_trippers.go:431]     Accept: application/json
I1118 20:39:19.656952  566872 round_trippers.go:431]     Content-Type: application/json
I1118 20:39:19.656956  566872 round_trippers.go:431]     User-Agent: kubectl/v1.19.2 (linux/amd64) kubernetes/f574309
I1118 20:39:20.352189  566872 round_trippers.go:446] Response Status: 200 OK in 695 milliseconds
I1118 20:39:20.352264  566872 round_trippers.go:449] Response Headers:
I1118 20:39:20.352298  566872 round_trippers.go:452]     Audit-Id: b3c81766-8092-4c51-8a14-be63b438db31
I1118 20:39:20.352323  566872 round_trippers.go:452]     Cache-Control: no-cache, private
I1118 20:39:20.352379  566872 round_trippers.go:452]     Content-Type: application/json
I1118 20:39:20.352427  566872 round_trippers.go:452]     Date: Thu, 18 Nov 2021 15:09:20 GMT
I1118 20:39:20.353551  566872 request.go:1097] Response Body: {"kind":"Pod","apiVersion":"v1","metadata":{"name":"dnsutils-bsijqj","namespace":"default","selfLink":"/api/v1/namespaces/default/pods/dnsutils-bsijqj","uid":"980a715f-c699-478e-b2a4-d106a7ac6ea4","resourceVersion":"2660951","creationTimestamp":"2021-11-18T15:09:11Z","deletionTimestamp":"2021-11-18T15:09:20Z","deletionGracePeriodSeconds":0,"labels":{"app.kubernetes.io/part-of":"k8s-triliovault","preflight-run":"bsijqj","trilio":"tvk-preflight"},"annotations":{"kubectl.kubernetes.io/last-applied-configuration":"{\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"labels\":{\"app.kubernetes.io/part-of\":\"k8s-triliovault\",\"preflight-run\":\"bsijqj\",\"trilio\":\"tvk-preflight\"},\"name\":\"dnsutils-bsijqj\",\"namespace\":\"default\"},\"spec\":{\"containers\":[{\"command\":[\"sleep\",\"3600\"],\"image\":\"gcr.io/kubernetes-e2e-test-images/dnsutils:1.3\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"dnsutils\",\"resources\":{\"limits\":{\"cpu\":\"500m\",\"memory\":\"128Mi\"},\"requests\" [truncated 3706 chars]
pod "dnsutils-bsijqj" force deleted
I1118 20:39:20.355041  566872 round_trippers.go:420] GET https://35.228.43.178/api/v1/namespaces/default/pods?fieldSelector=metadata.name%3Ddnsutils-bsijqj
I1118 20:39:20.355080  566872 round_trippers.go:427] Request Headers:
I1118 20:39:20.355103  566872 round_trippers.go:431]     Accept: application/json
I1118 20:39:20.355121  566872 round_trippers.go:431]     User-Agent: kubectl/v1.19.2 (linux/amd64) kubernetes/f574309
I1118 20:39:20.823543  566872 round_trippers.go:446] Response Status: 200 OK in 468 milliseconds
I1118 20:39:20.823636  566872 round_trippers.go:449] Response Headers:
I1118 20:39:20.823669  566872 round_trippers.go:452]     Cache-Control: no-cache, private
I1118 20:39:20.823688  566872 round_trippers.go:452]     Content-Type: application/json
I1118 20:39:20.823704  566872 round_trippers.go:452]     Content-Length: 134
I1118 20:39:20.823720  566872 round_trippers.go:452]     Date: Thu, 18 Nov 2021 15:09:20 GMT
I1118 20:39:20.823735  566872 round_trippers.go:452]     Audit-Id: eeabfe6e-811f-4c42-b504-0eb8dd07dd0a
I1118 20:39:20.823802  566872 request.go:1097] Response Body: {"kind":"PodList","apiVersion":"v1","metadata":{"selfLink":"/api/v1/namespaces/default/pods","resourceVersion":"2660955"},"items":[]}
[2021-11-18 20:39:20] [ INFO ] Checking if volume snapshot and restore enabled in K8s cluster...

[2021-11-18 20:39:20] [ INFO ]  Creating source pod and pvc for volume-snapshot check

persistentvolumeclaim/source-pvc-bsijqj created
pod/source-pod-bsijqj created
pod/source-pod-bsijqj condition met
[2021-11-18 20:39:47] [ INFO ]  ✔ Created source pod and pvc

[2021-11-18 20:39:48] [ INFO ]  Creating volume snapshot from source pvc

volumesnapshot.snapshot.storage.k8s.io/snapshot-source-pvc-bsijqj created
[2021-11-18 20:40:18] [ INFO ]  ✔ Created volume snapshot from source pvc and is readyToUse

[2021-11-18 20:40:18] [ INFO ]  Creating restore pod from volume snapshot

persistentvolumeclaim/restored-pvc-bsijqj created
pod/restored-pod-bsijqj created
pod/restored-pod-bsijqj condition met
[2021-11-18 20:41:04] [ INFO ]  ✔ Created restore pod from volume snapshot

Check for file ->  /demo/data/sample-file.txt
[2021-11-18 20:41:09] [ INFO ]  ✔ Restored pod has expected data

warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
pod "source-pod-bsijqj" force deleted
[2021-11-18 20:41:11] [ INFO ]  ✔ Deleted source pod

[2021-11-18 20:41:11] [ INFO ]  Creating volume snapshot from unused source pvc

volumesnapshot.snapshot.storage.k8s.io/unused-source-pvc-bsijqj created
[2021-11-18 20:41:39] [ INFO ]  ✔ Created volume snapshot from unused source pvc and is readyToUse

[2021-11-18 20:41:39] [ INFO ]  Creating restore pod from volume snapshot of unused pv

persistentvolumeclaim/unused-restored-pvc-bsijqj created
pod/unused-restored-pod-bsijqj created
pod/unused-restored-pod-bsijqj condition met
[2021-11-18 20:42:28] [ INFO ]  ✔ Created restore pod from volume snapshot of unused pv

/demo/data/sample-file.txt
[2021-11-18 20:42:31] [ INFO ]  ✔ Restored pod from volume snapshot of unused pv has expected data

[2021-11-18 20:42:31] [ INFO ] All Pre-flight Checks Succeeded!

[2021-11-18 20:42:31] [ INFO ]  Cleaning up residual resources...

Cleaning PVC - source-pvc-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
persistentvolumeclaim "source-pvc-bsijqj" force deleted
Error from server (NotFound): persistentvolumeclaims "source-pvc-bsijqj" not found

Cleaning PVC - restored-pvc-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
persistentvolumeclaim "restored-pvc-bsijqj" force deleted
error: timed out waiting for the condition on persistentvolumeclaims/restored-pvc-bsijqj
persistentvolumeclaim/restored-pvc-bsijqj patched

Cleaning PVC - unused-restored-pvc-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
persistentvolumeclaim "unused-restored-pvc-bsijqj" force deleted
error: timed out waiting for the condition on persistentvolumeclaims/unused-restored-pvc-bsijqj
persistentvolumeclaim/unused-restored-pvc-bsijqj patched


Cleaning VolumeSnapshot - snapshot-source-pvc-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
volumesnapshot.snapshot.storage.k8s.io "snapshot-source-pvc-bsijqj" force deleted
Error from server (NotFound): volumesnapshots.snapshot.storage.k8s.io "snapshot-source-pvc-bsijqj" not found


Cleaning VolumeSnapshot - unused-source-pvc-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
volumesnapshot.snapshot.storage.k8s.io "unused-source-pvc-bsijqj" force deleted
error: timed out waiting for the condition on volumesnapshots/unused-source-pvc-bsijqj
volumesnapshot.snapshot.storage.k8s.io/unused-source-pvc-bsijqj patched


Cleaning Pods - source-pod-bsijqj restored-pod-bsijqj unused-restored-pod-bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
pod "restored-pod-bsijqj" force deleted
pod "unused-restored-pod-bsijqj" force deleted
Error from server (NotFound): pods "source-pod-bsijqj" not found

Cleaning all resources related to label - preflight-run: bsijqj
warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
No resources found
[2021-11-18 20:43:23] [ INFO ]  ✔ Cleaned up all the resources

