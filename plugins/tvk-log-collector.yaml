apiVersion: krew.googlecontainertools.github.com/v1alpha2
kind: Plugin
metadata:
  name: tvk-log-collector
spec:
  homepage: https://github.com/trilioData/tvk-plugins/blob/master/docs/log-collector/README.md
  shortDescription: TVK Log-Collector to collect logs of TVK Resources
  version: v1.2.2
  caveats: |
    Curl and Git neeed to be installed on system for Krew index update to work properly
  platforms:
  - selector:
      matchLabels:
        os: linux
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_linux_amd64.tar.gz
    sha256: 3a649ba9604dbfe899e5588f7f8abd3ee1ca73305d982767e38eb129791fe8fd
    bin: log-collector
    files:
    - from: '*'
      to: .

  - selector:
      matchLabels:
        os: linux
        arch: arm64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_linux_arm64.tar.gz
    sha256: 6315f629dbbfc86783f0ea72659885b16488506b3264a188ff207726455ea107
    bin: log-collector
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: linux
        arch: arm
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_linux_arm.tar.gz
    sha256: 59c8d08730c7a51297783ebb004e1451af571111f8a4a1a1e69d8a636342f1c6
    bin: log-collector
    files:
    - from: '*'
      to: .

  - selector:
      matchLabels:
        os: darwin
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_darwin_amd64.tar.gz
    sha256: 441ae85544c3cf3a62ab10bc99fad4ed36d2639c7a4f75a2bab2e0057525c18a
    bin: log-collector
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: darwin
        arch: arm64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_darwin_arm64.tar.gz
    sha256: 570f22510b2729f9149f6b8785a2c2fda19c5a8a8b1a70920db4c4fe7c36ff3a
    bin: log-collector
    files:
    - from: '*'
      to: .

  - selector:
      matchLabels:
        os: windows
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_windows_amd64.zip
    sha256: 0ba445ae144bce776722f2954d8088683be7f5c109122df89fb76fc82b2650e8
    bin: log-collector.exe
    files:
    - from: '*'
      to: .

  # TODO: remove/comment following two selectors 'windows/arm64' & 'windows/arm' while adding it to 'plugins' dir, as these are not supported by krew as of now.
  - selector:
      matchLabels:
        os: windows
        arch: arm64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_windows_arm64.zip
    sha256: 687b543ed8a9d02543674e4eebd8c2de409d5fe5d3e06071da1881380a5858d6
    bin: log-collector.exe
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: windows
        arch: arm
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.2.2/log-collector_v1.2.2_windows_arm.zip
    sha256: 3c9d1d62faf66478f18764565dd404f72ae9f5b705522c0f0aa389cc23b32b8b
    bin: log-collector.exe
    files:
    - from: '*'
      to: .

  description: |
    tvk-log-collector is a kubectl plugin which collects the information mainly yaml configuration and logs from k8s cluster for
    debugging TVK application.

    This plugin will generate triliovault-<date-time>.zip file containing cluster debugging information.

    > Check available flags for tvk-log-collector plugin with :-
    kubectl tvk-log-collector --help

    Parameter   	Default     	Description
    --clustered 	false       	whether clustered installtion of trilio application
    --namespaces 	[]          	list of namespaces to look for resources
    --kube_config 	~/.kube/config 	path to the kubernetes config
    --keep-source-folder 	    false 	        Keep source directory and Zip both
    --log-level 	INFO 	        log level for debugging

    > Usage :-

    kubectl tvk-log-collector --clustered --log-level INFO --kubeconfig /home/usr/kubeconfig
