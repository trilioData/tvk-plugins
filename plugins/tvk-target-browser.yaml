apiVersion: krew.googlecontainertools.github.com/v1alpha2
kind: Plugin
metadata:
  name: tvk-target-browser
spec:
  homepage: https://github.com/trilioData/tvk-plugins/blob/master/docs/target-browser/README.md
  shortDescription: TVK Target Browser queries mounted target to get details of backup, backupPlan, backup metadata, etc.
  version: v1.1.0-rc4
  caveats: |
    Curl and Git neeed to be installed on system for Krew index update to work properly
  platforms:
  - selector:
      matchLabels:
        os: linux
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_linux_amd64.tar.gz
    sha256: a3b9758b3bb80573bffd29a8d9f85a776d60fb8933a7971722b24a65e2d7c9de
    bin: target-browser
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: linux
        arch: arm64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_linux_arm64.tar.gz
    sha256: 2396b7b807403ae866f28e3c7e682fa156f8396b585463bfa37fe8e71b537f3a
    bin: target-browser
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: linux
        arch: arm
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_linux_arm.tar.gz
    sha256: f10a16f38caeb34746548853cf8b4d9a747c6a131521819416b4a0ca50bc749e
    bin: target-browser
    files:
    - from: '*'
      to: .

  - selector:
      matchLabels:
        os: darwin
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_darwin_amd64.tar.gz
    sha256: 78460a2b383d00293a563d14b49c3e489991aac4b16e11693201bca6d1a14b41
    bin: target-browser
    files:
    - from: '*'
      to: .
  - selector:
      matchLabels:
        os: darwin
        arch: arm64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_darwin_arm64.tar.gz
    sha256: f485af1163cfb3f34cb34a9e415fe7578fcf4fe37961db2e331e0d39589fbae6
    bin: target-browser
    files:
    - from: '*'
      to: .

  - selector:
      matchLabels:
        os: windows
        arch: amd64
    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_windows_amd64.zip
    sha256: f065a506f2cebbc8550e25a437780ee059de1c3d21e304fac3513781636b6c11
    bin: target-browser.exe
    files:
    - from: '*'
      to: .

  # TODO: remove/comment following two selectors 'windows/arm64' & 'windows/arm' while adding it to 'plugins' dir, as these are not supported by krew as of now.
  #  - selector:
  #      matchLabels:
  #        os: windows
  #        arch: arm64
  #    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_windows_arm64.zip
  #    sha256: a7a9b45bb79e9e15639142781aa752a740e13f673f2733b4807b646895046a35
  #    bin: target-browser.exe
  #    files:
  #    - from: '*'
  #      to: .
  #  - selector:
  #      matchLabels:
  #        os: windows
  #        arch: arm
  #    uri: https://github.com/trilioData/tvk-plugins/releases/download/v1.1.0-rc4/target-browser_v1.1.0-rc4_windows_arm.zip
  #    sha256: 59d5c96ec2b8eed8db50302bb0d32a20d15622f55bf9ca23735fb0e63ec58b53
  #    bin: target-browser.exe
  #    files:
  #    - from: '*'
  #      to: .

  description: |
    tvk-target-browser is a kubectl plugin which can query content of mounted target location to get details of backup,
    backupPlan and metadata details of backup via HTTP/HTTPS calls to target-browser server.

    > Check available commands, flags & options for tvk-target-browser plugin with :-
    kubectl tvk-target-browser --help

    > Usage :-

    # List of backupPlans
    kubectl tvk-target-browser get backupPlan --target-name <name> --target-namespace <namespace>

    # List of backups
    kubectl tvk-target-browser get backup --target-name <name> --target-namespace <namespace>

    # List of backups using backupPlan UID
    kubectl tvk-target-browser get backup --backup-plan-uid <uid> --target-name <name> --target-namespace <namespace>

    # Get specific backupPlan
    kubectl tvk-target-browser get backupPlan <backup-plan-uid>  --target-name <name> --target-namespace <namespace>

    # Get specific backup
    kubectl tvk-target-browser get backup <backup-uid> --target-name <name> --target-namespace <namespace>

    # Metadata of specific backup object
    kubectl tvk-target-browser get metadata --backup-uid <uid> --backup-plan-uid <uid> --target-name <name> --target-namespace <namespace>

    # Resource Metadata of specific backup object
    kubectl tvk-target-browser get resource-metadata --backup-uid <uid> --backup-plan-uid <uid> --target-name <name> --target-namespace <namespace> --group <group> --version <version> --kind <kind> --name <resource-name>

    # Trilio Resources for specific backup object
    kubectl tvk-target-browser get backup trilio-resources <backup-uid> --backup-plan-uid <uid> --kinds ClusterBackupPlan,Backup,Hook --target-name <name> --target-namespace <namespace>

    # List of backups: filter by [expirationStartTime] and [expirationEndTime]
    kubectl tvk-target-browser get backup --expiration-start-time <expiration-start-time> --expiration-end-time <expiration-end-time>--target-name <name> --target-namespace <namespace>

    # List of backups: filter by [creationStartTime] and [creationEndTime]
    kubectl tvk-target-browser get backup --creation-start-time <creation-start-time> --creation-end-time <creation-end-time>--target-name <name> --target-namespace <namespace>

    # List of backupPlans: filter by [creationStartTime] and [creationEndTime]
    kubectl tvk-target-browser get backupPlan --creation-start-time <creation-start-time> --creation-end-time <creation-end-time>--target-name <name> --target-namespace <namespace>

    # List of backupPlans: filter by [tvkInstanceUID]
    kubectl tvk-target-browser get backupPlan --tvk-instance-uid <uid> --target-name <name> --target-namespace <namespace>

    # List of backupPlans: filter by [tvkInstanceName]
    kubectl tvk-target-browser get backupPlan --tvk-instance-name <name> --target-name <name> --target-namespace <namespace>

    # List of backups: filter by [tvkInstanceUID]
    kubectl tvk-target-browser get backup --tvk-instance-uid <uid> --target-name <name> --target-namespace <namespace>

    # List of backups: filter by [tvkInstanceName]
    kubectl tvk-target-browser get backup --tvk-instance-name <name> --target-name <name> --target-namespace <namespace>
